# This configuration is used to benchmark HPC systems
# It runs the benchmark model for a single file, over multiple epochs
training:
    trainer:
        type: keras
    optimizer:
        type: adam
        learning_rate:
            type: piecewise
            boundaries: [100] # Number of samples (not epochs)
            values: [1.0e-2, 1.0e-3]
            # type: cosinedecayrestarts
            # initial_learning_rate: 1.0e-2
            # first_decay_steps: 6000
            # t_mul: 1.0
            # m_mul: 1.0
    num_epochs: 1
    # validation_frequency: 1 epoch
    validation_frequency: 36 file
loader:
    type: file
    # filenames: [ "data/air_temperature/5TB/20200301T*Z.nc"]  # One file
    # filenames: [ "data/air_temperature/5TB/2020*1T*Z.nc"]    # 36 files
    # filenames: [ "data/air_temperature/5TB/202*01T*Z.nc"]    # 24 files
    filenames: [ "data/air_temperature/5TB/2020*T*Z.nc", "data/air_temperature/5TB/20210[12]*T*Z.nc"]
    omit_filenames: ["data/air_temperature/5TB/20210301T*Z.nc",
                "data/air_temperature/5TB/20210315T*Z.nc",
                "data/air_temperature/5TB/20210402T*Z.nc",
                "data/air_temperature/5TB/20210416T*Z.nc",
                "data/air_temperature/5TB/20210501T*Z.nc",
                "data/air_temperature/5TB/20210515T*Z.nc",
                "data/air_temperature/5TB/20210602T*Z.nc",
                "data/air_temperature/5TB/20210616T*Z.nc",
                "data/air_temperature/5TB/20210701T*Z.nc",
                "data/air_temperature/5TB/20210715T*Z.nc",
                "data/air_temperature/5TB/20210802T*Z.nc",
                "data/air_temperature/5TB/20210816T*Z.nc",
                "data/air_temperature/5TB/20210901T*Z.nc",
                "data/air_temperature/5TB/20210915T*Z.nc",
                "data/air_temperature/5TB/20211002T*Z.nc",
                "data/air_temperature/5TB/20211016T*Z.nc",
                "data/air_temperature/5TB/20211101T*Z.nc",
                "data/air_temperature/5TB/20211115T*Z.nc",
                "data/air_temperature/5TB/20211202T*Z.nc",
                "data/air_temperature/5TB/20211216T*Z.nc",
                "data/air_temperature/5TB/20220101T*Z.nc",
                "data/air_temperature/5TB/20220115T*Z.nc",
                "data/air_temperature/5TB/20220202T*Z.nc",
                "data/air_temperature/5TB/20220216T*Z.nc"
    ]
    normalization: data/air_temperature/normalization.yml
    predict_diff: True
    patch_size: 512
    batch_size: 1
    with_leadtime: False
    num_parallel_calls: 12
    debug: False
    extra_features:
        - type: leadtime
        - type: x
        - type: y
loader_validation:
    type: file
    filenames: ["data/air_temperature/5TB/20210301T*Z.nc",
                "data/air_temperature/5TB/20210315T*Z.nc",
                "data/air_temperature/5TB/20210402T*Z.nc",
                "data/air_temperature/5TB/20210416T*Z.nc",
                "data/air_temperature/5TB/20210501T*Z.nc",
                "data/air_temperature/5TB/20210515T*Z.nc",
                "data/air_temperature/5TB/20210602T*Z.nc",
                "data/air_temperature/5TB/20210616T*Z.nc",
                "data/air_temperature/5TB/20210701T*Z.nc",
                "data/air_temperature/5TB/20210715T*Z.nc",
                "data/air_temperature/5TB/20210802T*Z.nc",
                "data/air_temperature/5TB/20210816T*Z.nc",
                "data/air_temperature/5TB/20210901T*Z.nc",
                "data/air_temperature/5TB/20210915T*Z.nc",
                "data/air_temperature/5TB/20211002T*Z.nc",
                "data/air_temperature/5TB/20211016T*Z.nc",
                "data/air_temperature/5TB/20211101T*Z.nc",
                "data/air_temperature/5TB/20211115T*Z.nc",
                "data/air_temperature/5TB/20211202T*Z.nc",
                "data/air_temperature/5TB/20211216T*Z.nc",
                "data/air_temperature/5TB/20220101T*Z.nc",
                "data/air_temperature/5TB/20220115T*Z.nc",
                "data/air_temperature/5TB/20220202T*Z.nc",
                "data/air_temperature/5TB/20220216T*Z.nc"
    ]
    normalization: data/air_temperature/normalization.yml
    # patch_size: 512
    batch_size: 1
    predict_diff: True
    with_leadtime: False
    num_parallel_calls: 12
    debug: False
    # filename_validation_cache: data/air_temperature/validation_cache
    x_range: [300,1068]
    y_range: [550,1062]
    # x_range: [215, 1751]
    # y_range: [50, 2098]
    extra_features:
        - type: leadtime
        - type: x
        - type: y
loader_test:
    type: file
    filenames: ["data/air_temperature/5TB/20210[3-9]*T*Z.nc",
                "data/air_temperature/5TB/20211*T*Z.nc",
                "data/air_temperature/5TB/2022*T*Z.nc"]
    normalization: data/air_temperature/normalization.yml
    # patch_size: 512
    batch_size: 1
    predict_diff: True
    with_leadtime: False
    num_parallel_calls: 12
    debug: False
    # filename_validation_cache: data/air_temperature/validation_cache
    # x_range: [300,1068]
    # y_range: [550,1062]
    x_range: [215, 1751]
    y_range: [50, 2098]
    extra_features:
        - type: leadtime
        - type: x
        - type: y
models:
    - type: BasicBenchmark
      name: cnn
      leadtime_dependent: False
      neighbourhood_size: 3
      filter_sizes: [12, 5, 5]
    - type: Unet
      name: unet_f16_l6_c3_p2
      features: 16
      layers: 6
      conv_size: 3
      pool_size: 2
    - type: Unet
      name: unet_f16_l6_c1_p2
      features: 16
      layers: 6
      conv_size: 1
      pool_size: 2
    - type: Unet
      name: unet_f16_l3_c3_p4
      features: 16
      layers: 3
      conv_size: 3
      pool_size: 4
    - type: Unet
      name: unet_f16_l3_c1_p4
      features: 16
      layers: 3
      conv_size: 1
      pool_size: 4
      # separable: True
      # batch_normalization: True
    - type: Dense
      name: dense_f12_l6
      features: 12
      layers: 6
      activation: "relu"
output:
    quantiles: [0.1, 0.5, 0.9]
loss:
    type: quantile_score
    # trim: 10
evaluators:
    - type: aggregator
tensorflow:
    num_threads: 48
